<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>处理中 - 微信聊天分析器</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        .processing-container {
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .processing-card {
            text-align: center;
            max-width: 500px;
        }
        .processing-icon {
            font-size: 4rem;
            color: #6c757d;
            margin-bottom: 2rem;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        .progress {
            height: 10px;
        }
        .step {
            padding: 0.5rem 0;
            border-left: 3px solid #e9ecef;
            padding-left: 1rem;
            margin-bottom: 1rem;
        }
        .step.active {
            border-left-color: #0d6efd;
            background-color: #f8f9fa;
        }
        .step.completed {
            border-left-color: #198754;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-comments"></i> 微信聊天分析器
            </a>
        </div>
    </nav>
    
    <!-- 主要内容区域 -->
    <main class="container">
        <div class="processing-container">
            <div class="processing-card">
                <div class="processing-icon pulse">
                    <i class="fas fa-cogs"></i>
                </div>
                
                <h2 class="mb-4">正在分析中...</h2>
                
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title" th:text="${report.chatName}">聊天分析</h5>
                        <p class="text-muted mb-4">
                            分析日期：<span th:text="${#temporals.format(report.analysisDate, 'yyyy年MM月dd日')}"></span>
                        </p>
                        
                        <!-- 进度条 -->
                        <div class="progress mb-4">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 60%" 
                                 aria-valuenow="60" aria-valuemin="0" aria-valuemax="100">
                                正在处理...
                            </div>
                        </div>
                        
                        <!-- 处理步骤 -->
                        <div class="text-start">
                            <div class="step completed">
                                <i class="fas fa-check text-success"></i>
                                <strong>步骤1：</strong> 获取聊天数据
                            </div>
                            <div class="step completed">
                                <i class="fas fa-check text-success"></i>
                                <strong>步骤2：</strong> 数据预处理
                            </div>
                            <div class="step active">
                                <i class="fas fa-spinner fa-spin text-primary"></i>
                                <strong>步骤3：</strong> AI结构化分析
                            </div>
                            <div class="step">
                                <i class="fas fa-clock text-muted"></i>
                                <strong>步骤4：</strong> 生成最终报告
                            </div>
                            <div class="step">
                                <i class="fas fa-clock text-muted"></i>
                                <strong>步骤5：</strong> 保存分析结果
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-footer text-center">
                        <p class="text-muted mb-2">
                            <i class="fas fa-info-circle"></i>
                            分析过程通常需要1-3分钟，请耐心等待
                        </p>
                        
                        <div class="btn-group">
                            <button class="btn btn-outline-primary" onclick="location.reload()">
                                <i class="fas fa-sync-alt"></i> 刷新页面
                            </button>
                            <a href="/chat-analysis/" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left"></i> 返回分析
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 自动刷新页面
        setTimeout(() => {
            location.reload();
        }, 10000); // 10秒后自动刷新
        
        // 显示提示信息
        let refreshCount = 0;
        setInterval(() => {
            refreshCount++;
            if (refreshCount < 10) {
                const tips = [
                    "正在从Chatlog服务获取聊天数据...",
                    "正在清洗和预处理聊天内容...",
                    "正在调用AI服务进行智能分析...",
                    "正在生成结构化数据...",
                    "正在生成最终分析报告...",
                    "即将完成，请稍候..."
                ];
                
                const progressBar = document.querySelector('.progress-bar');
                if (progressBar) {
                    progressBar.textContent = tips[Math.floor(Math.random() * tips.length)];
                }
            }
        }, 3000);
    </script>
</body>
</html>